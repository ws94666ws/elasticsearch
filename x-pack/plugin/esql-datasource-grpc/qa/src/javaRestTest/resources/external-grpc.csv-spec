// Tests for Arrow Flight (gRPC) external data source
// Uses {{employees}} template that gets replaced with flight://localhost:PORT/employees

readAllEmployees
EXTERNAL "{{employees}}"
| KEEP emp_no, first_name, last_name, salary, still_hired, height
| SORT emp_no
| LIMIT 5;

emp_no:integer | first_name:keyword | last_name:keyword | salary:integer | still_hired:boolean | height:double
10001          | "Georgi"           | "Facello"         | 57305          | true                | 2.03
10002          | "Bezalel"          | "Simmel"          | 56371          | true                | 2.08
10003          | "Parto"            | "Bamford"         | 61805          | false               | 1.83
10004          | "Chirstian"        | "Koblick"         | 36174          | true                | 1.78
10005          | "Kyoichi"          | "Maliniak"        | 63528          | true                | 2.05
;

selectSpecificColumns
EXTERNAL "{{employees}}"
| KEEP emp_no, first_name, last_name, salary
| SORT emp_no
| LIMIT 5;

emp_no:integer | first_name:keyword | last_name:keyword | salary:integer
10001          | "Georgi"           | "Facello"         | 57305
10002          | "Bezalel"          | "Simmel"          | 56371
10003          | "Parto"            | "Bamford"         | 61805
10004          | "Chirstian"        | "Koblick"         | 36174
10005          | "Kyoichi"          | "Maliniak"        | 63528
;

filterByEmployeeNumber
EXTERNAL "{{employees}}"
| WHERE emp_no == 10001
| KEEP emp_no, first_name, last_name;

emp_no:integer | first_name:keyword | last_name:keyword
10001          | "Georgi"           | "Facello"
;

filterBySalaryRange
EXTERNAL "{{employees}}"
| WHERE salary > 60000 AND salary < 70000
| KEEP emp_no, first_name, salary
| SORT emp_no
| LIMIT 5;

emp_no:integer | first_name:keyword | salary:integer
10003          | "Parto"            | 61805
10005          | "Kyoichi"          | 63528
10006          | "Anneke"           | 60335
10009          | "Sumant"           | 66174
10016          | "Kazuhito"         | 61358
;

filterByEmploymentStatus
EXTERNAL "{{employees}}"
| WHERE still_hired == false
| KEEP emp_no, first_name, last_name, still_hired
| SORT emp_no
| LIMIT 3;

emp_no:integer | first_name:keyword | last_name:keyword | still_hired:boolean
10003          | "Parto"            | "Bamford"         | false
10006          | "Anneke"           | "Preusig"         | false
10009          | "Sumant"           | "Peac"            | false
;

aggregateCount
EXTERNAL "{{employees}}"
| STATS count = COUNT(*);

count:long
100
;

aggregateAverageSalary
EXTERNAL "{{employees}}"
| STATS avg_salary = AVG(salary);

avg_salary:double
48248.55
;

aggregateSalaryStats
EXTERNAL "{{employees}}"
| STATS min_salary = MIN(salary), max_salary = MAX(salary), avg_salary = AVG(salary);

min_salary:integer | max_salary:integer | avg_salary:double
25324              | 74999              | 48248.55
;

filterAndSort
EXTERNAL "{{employees}}"
| WHERE salary > 70000
| KEEP emp_no, first_name, salary
| SORT salary DESC
| LIMIT 5;

emp_no:integer | first_name:keyword | salary:integer
10029          | "Otmar"            | 74999
10045          | "Moss"             | 74970
10007          | "Tzvetan"          | 74572
10027          | "Divier"           | 73851
10019          | "Lillian"          | 73717
;

evalComputedColumn
EXTERNAL "{{employees}}"
| EVAL annual_bonus = salary * 0.1
| KEEP emp_no, first_name, salary, annual_bonus
| SORT emp_no
| LIMIT 3;

emp_no:integer | first_name:keyword | salary:integer | annual_bonus:double
10001          | "Georgi"           | 57305          | 5730.5
10002          | "Bezalel"          | 56371          | 5637.1
10003          | "Parto"            | 61805          | 6180.5
;

complexQuery
EXTERNAL "{{employees}}"
| WHERE still_hired == true AND salary > 55000
| EVAL salary_category = CASE(salary < 60000, "standard", salary < 70000, "senior", "principal")
| STATS count = COUNT(*), avg_salary = AVG(salary) BY salary_category
| SORT salary_category;

count:long | avg_salary:double | salary_category:keyword
2          | 74075.0           | "principal"
5          | 67017.0           | "senior"
4          | 56789.25          | "standard"
;
